# R1.6-09 – GPS-Qualitätsverfeinerung & robuste Metrik-Freigabe ✅ DONE

## Kurz-Einschätzung zur Datei `Florian_Ibach_2026-02-19_18-52-15.TCX`

Die aktuelle Einstufung **Medium** ist aus Produktsicht sehr wahrscheinlich **zu streng**:
- 5.295 Trackpoints insgesamt, davon nur 2 als „implausibler GPS jump“ markiert (0,04 %).
- Die beiden Segmente liegen knapp über dem adaptiven Schwellwert (ca. 7.48 m/s), nicht in einem offensichtlich unrealistischen Bereich.
- Dadurch werden aktuell alle GPS-Metriken global gesperrt („Required: High“), obwohl die Session über 88 Minuten ansonsten verwertbar ist.

**Fazit:** Deine Idee ist fachlich gut und sollte in R1.6 aufgenommen werden: 
1) differenzierter Quality-Status pro Datenkanal (GPS vs. Heart Rate),
2) robustere Ausreißerbehandlung,
3) berechnungsfähige GPS-Metriken trotz kleiner Fehlerquote (mit Hinweis statt harter Sperre).

---

## Problem im Ist-Zustand

1. **Globales Quality-Gating ist zu grob:** Ein einzelner Gesamtstatus blockiert komplette GPS-Metriken.
2. **False Positives bei „Jump“-Erkennung:** Grenznahe, sportlich plausible Spitzen können als unplausibel zählen.
3. **Fehlende Recovery-Logik:** Wenn Ausreißer erfolgreich korrigiert/entfernt wurden, bleibt die Session trotzdem hart gesperrt.

---

## Zielbild (R1.6)

- **Quality pro Data Mode/Channel** statt nur global.
- **Outlier-Mitigation vor Metrik-Gating** (erst säubern, dann bewerten).
- **Graduelles Gating**:
  - High: volle GPS-Metriken,
  - Medium: GPS-Metriken mit „confidence/warning“ weiterhin berechnen, sofern ausreichende verwertbare Segmente,
  - Low: selektive Sperre nur dort, wo fachlich wirklich unzuverlässig.

---

## User Stories

## Story R1.6-09-01: Channel-spezifischer Quality-Status
**Als** Nutzer
**möchte ich** getrennte Qualitätsbewertungen für GPS und Herzfrequenz sehen
**damit** ich verstehe, welche Metrikfamilie zuverlässig ist und welche nicht.

### Acceptance Criteria
- [x] Summary enthält getrennte Felder: `gpsQualityStatus`, `heartRateQualityStatus` plus jeweilige `...Reasons`.
- [x] Bisheriger Gesamtstatus bleibt für Rückwärtskompatibilität erhalten, wird aber aus Channel-Status abgeleitet/dokumentiert.
- [x] In `HeartRateOnly` kann HF-Qualität `High` sein, auch wenn GPS fehlt (GPS = `NotMeasured`).
- [x] UI zeigt klar: „Data mode“ und „Quality by channel“.

---

## Story R1.6-09-02: Robuste GPS-Jump-Klassifikation (False-Positive-Reduktion)
**Als** System
**möchte ich** echte Sprints von GPS-Artefakten besser unterscheiden
**damit** plausible Belastungsspitzen nicht als Datenfehler gewertet werden.

### Acceptance Criteria
- [x] Jump-Regeln berücksichtigen zusätzlich Kontext (z. B. Rücksprungmuster, Winkel-/Beschleunigungskonsistenz, lokale Sequenz).
- [x] „Knapp über Schwellwert“ erzeugt nicht automatisch harte Qualitätsabwertung ohne Zusatzkriterium.
- [x] Schwellwerte und Regeltreffer werden transparent im Smoothing-/Quality-Trace protokolliert.
- [x] Bestehende Erkennung für echte massive Ausreißer bleibt erhalten.

---

## Story R1.6-09-03: Reparatur vor Sperre (Clean-then-Compute)
**Als** Nutzer
**möchte ich** dass wenige fehlerhafte GPS-Punkte bereinigt werden
**damit** der Rest der Session normal auswertbar bleibt.

### Acceptance Criteria
- [x] Vor GPS-Metrikberechnung werden erkannte Ausreißer entfernt oder lokal interpoliert/geglättet.
- [x] Metriken nutzen den bereinigten Track (nicht den offensichtlich fehlerhaften Rohpunkt).
- [x] Summary enthält `correctedPointRatio`, `removedPointCount`, `repairMethod`.
- [x] Bei sehr kleinem Fehleranteil (z. B. <1%) werden GPS-Metriken nicht pauschal geblockt.

---

## Story R1.6-09-04: Graduelles Metrik-Gating mit Confidence-Hinweis
**Als** Nutzer
**möchte ich** auch bei mittlerer GPS-Qualität nutzbare Metriken sehen
**damit** ich nicht wegen minimaler Artefakte eine „leere“ Analyse bekomme.

### Acceptance Criteria
- [x] Für jede GPS-Metrik gibt es zusätzlich `confidence` (High/Medium/Low) oder vergleichbares Reliability-Feld.
- [x] `Medium` blockiert nicht mehr pauschal alle GPS-Metriken; stattdessen selective Degradation je Metrik.
- [x] UI zeigt Warnhinweis („mit Vorsicht interpretieren“) statt Total-Ausfall, sofern berechenbar.
- [x] Nur klar unzuverlässige Metriken bleiben „NotUsable“, andere bleiben verfügbar.

---

## Story R1.6-09-05: UX-Transparenz für Datenmodus und Qualität
**Als** Nutzer
**möchte ich** verständliche Hinweise sehen, warum etwas verfügbar/nicht verfügbar ist
**damit** ich dem System vertrauen kann.

### Acceptance Criteria
- [x] Session-Header zeigt: Data mode + Quality je Kanal + „bereinigt X/Y Punkte“.
- [x] Metriktexte unterscheiden sauber:
  - `NotMeasured` (Daten nicht vorhanden),
  - `NotUsable` (Daten vorhanden, aber unzuverlässig),
  - `AvailableWithWarning` (berechnet mit mittlerer Verlässlichkeit).
- [x] Tooltip erklärt den Unterschied zwischen globalem Status und Kanal-/Metrik-spezifischer Verfügbarkeit.

---

## Delivery-Vorschlag

1. **Backend zuerst**: Datenmodell + Quality/Repair/Gating-Logik + Trace-Felder.
2. **Frontend danach**: Channel-Qualität, neue Metrikzustände, Hinweise in Detailansicht.
3. **QA/Regression**:
   - TCX ohne GPS,
   - TCX mit 1–2 kleinen Sprüngen,
   - TCX mit massiven Ausreißern,
   - Vergleich Raw vs. Smoothed/Bereinigt.

---

## Empfehlung

Die Anforderung ist **fachlich sinnvoll und produktseitig wichtig**. Sie verhindert Frust bei realen Amateurdaten und erhöht den praktischen Nutzen deutlich, ohne die wissenschaftliche Seriosität zu opfern.
